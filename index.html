<!DOCTYPE html>
<head>
   <meta charset="utf-8">

   <title>DBIx::Class (aka DBIC)</title>

   <!-- Core and extension CSS files -->
   <link rel="stylesheet" href="deck.js/core/deck.core.css">
   <link rel="stylesheet" href="deck.js/extensions/goto/deck.goto.css">
   <link rel="stylesheet" href="deck.js/extensions/menu/deck.menu.css">
   <link rel="stylesheet" href="deck.js/extensions/navigation/deck.navigation.css">
   <link rel="stylesheet" href="deck.js/extensions/status/deck.status.css">

   <!-- Theme CSS files (menu swaps these out) -->
   <link rel="stylesheet" id="style-theme-link" href="deck.js/themes/style/web-2.0.css">

   <link rel="stylesheet" href="/style.css">

   <script src="deck.js/modernizr.custom.js"></script>
</head>
<body class="deck-container">

   <div class="slide">
      <h2>DBIx::Class ðŸ’¡s</h2>
      <p>Arthur Axel fREW Schmidt</p>
      <p>YAPC::NA</p>
      <p>Orlando, Florida</p>
      <p>2014 June 24, 10:00</p>
   </div>

   <div class="slide">
      <h2>Deobfuscating the Basics ðŸ’¡</h2>

      <dl>
         <dt class="slide">Schema</dt>
         <dd class="slide">Bunch of Tables <span class="slide">(or views, for
            the pedants)</span></dd>
         <dt class="slide">Result</dt>
         <dd class="slide">Row</dd>
         <dt class="slide">ResultSet</dt>
         <dd class="slide">Query <span class="slide">!</span><span class="slide">!</span><span class="slide">!</span></dd>
         <dt class="slide">ResultSource</dt>
         <dd class="slide">Table <span class="slide">(...)</span></dd>
         <dt class="slide">less common, but:
            <span class="slide">Storage</span>
         </dt>
         <dd class="slide">Your RDBMS <span class="slide">(theoretically could
            be shared)</span></dd>
      </dl>
      <p class="slide">Questions?</p>
   </div>

   <div class="slide">
      <h2>What even is DBIx::Class?</h2>
      <img src="/img/ubik.jpg" class=r />
      <ul class=l>
         <li class="slide">SQL Generation</li>
         <li class="slide">Object Defintion and Instantiation</li>
      </ul>
   </div>

   <div class="slide">
      <h2>DBIC at "Compile" Time</h2>
      <ol>
         <li class="slide">
            Definition Options<ul>
               <li>Perl (vanilla DBIC)</li>
               <li>SQL (::Schema::Loader</li>
            </ul>
         </li>
         <li class="slide">Schema</li>
         <li class="slide">Result</li>
         <li class="slide">ResultSource</li>
         <li class="slide">ResultSet</li>
      </ol>
   </div>

   <div class="slide">
      <h2>Definition via ::Schema::Loader</h2>

      <ol>
         <li class="slide">Create DB with DDL or tool</li>
         <li class="slide">Generate DBIC Schema with ::Schema::Loader</li>
      </ol>
      <div class="slide">
         <pre>
use DBIx::Class::Schema::Loader 'make_schema_at';
make_schema_at( 'My::Schema',
    { debug => 1, dump_directory => './lib' },
    [ 'dbi:Pg:dbname="foo"', 'myuser', 'mypassword' ],
)
         </pre>
      </div>
   </div>

   <div class="slide">
      <h2>Definition via ::SL - hints</h2>

      <ol>
         <li class="slide">Name tables and columns consistently</li>
         <li class="slide">Create FK's</li>
         <li class="slide"><a
            href="https://github.com/frioux/dotfiles/blob/1b82b219b2117a438745007b8ce82bb0ec206682/zsh/envrc/S50_functions#L17,L19">sl_table_moniker</a></li>
         <li class="slide">(No more ::SL, I don't use it much)</li>
      </ol>
   </div>

   <div class="slide">
      <h2>Definition via Perl - Schema</h2>

      <ul>
         <li class=slide>Represents DB</li>
         <li class=slide>Good for high level methods</li>
         <li class=slide>Almost no boilerplate</li>
      </ul>
   </div>

   <div class="slide">
      <h2>Definition via Perl - Schema</h2>

      <pre>
package My::Schema; use 5.20.0; use warnings;

our $VERSION = 1;
use base 'DBIx::Class::Schema';

__PACKAGE__->load_namespaces(
   default_resultset_class => 'ResultSet',
);

1;
      </pre>
   </div>

   <div class="slide">
      <h2>Definition via Perl - Result</h2>

      <ul>
         <li class=slide>Represents Row</li>
         <li class=slide>Normally Bulk of Configuration</li>
         <li class=slide>Definition Conflates with ResultSource</li>
         <li class=slide>(candy)</li>
      </ul>
   </div>

   <div class="slide">
      <h2>Definition via Perl - Result Base Class</h2>

      <p class="slide">Optional, but a good idea</p>

      <div class="slide">
         <pre>
package My::Schema::Result;

use parent 'DBIx::Class::Core';

__PACKAGE__->load_components(
   'Helper::Row::RelationshipDWIM', # shorter slides
);

1;
         </pre>
      </div>
   </div>

   <div class="slide">
      <h2>Definition via Perl - Candy Base Class</h2>

      <p class="slide">Super Optional, but good for slides</p>

      <div class="slide">
         <pre>
package My::Schema::Candy;

use 5.20.0;
use warnings;

use parent 'DBIx::Class::Candy';

sub base { 'My::Schema::Result' }
sub perl_version { 20 }
sub autotable { 1 }

1;
         </pre>
      </div>
   </div>

   <div class="slide">
      <h2>Definition via Perl - Result Class</h2>

      <div class="slide">
         <pre>
package My::Schema::Result::Device;

use My::Schema::Candy;

primary_column id => {
   data_type => 'int',
   is_auto_increment => 1,
};

column type_id => { data_type => 'int' };

column name => {
   data_type => 'varchar',
   size      => 128,
};

column last_checkin => {
   data_type   => 'datetime',
   is_nullable => 1,
};

column is_enabled => { data_type => 'bit' };

has_many computer_device_links => '::Computer_Device', 'device_id';
belongs_to type => '::DeviceType', 'type_id';

unique_constraint name_and_type => [qw(name type_id)];

1;
         </pre>
      </div>
   </div>

   <div class="slide">
      <h2>Definition via Perl - Result Class</h2>

      <ol>
         <li class=slide> <pre> use My::Schema::Candy; </pre></li>
         <li class=slide><pre>
primary_column id => {
   data_type => 'int',
   is_auto_increment => 1,
};
         </pre></li>
      </ol>
   </div>

   <div class="slide">
      <h2>Definition via Perl - Result Class</h2>

      <pre>
column type_id => { data_type => 'int' };

column name => {
   data_type => 'varchar',
   size      => 128,
};

column last_checkin => {
   data_type   => 'datetime',
   is_nullable => 1,
};

column is_enabled => { data_type => 'bit' };
         </pre>
   </div>

   <div class=slide>
      <h2>Definition via Perl - Result Class</h2>

      <ol>
         <li class=slide><pre>
has_many computer_device_links => '::Computer_Device', 'device_id';
         </pre></li>
         <li class=slide><pre>
belongs_to type => '::DeviceType', 'type_id';
         </pre></li>
         <li class=slide><pre>
unique_constraint name_and_type => [qw(name type_id)];
         </pre></li>
      </ol>
   </div>

   <div class="slide">
      <h2>Deobfuscating Relationships ðŸ’¡</h2>

      <dl>
         <dt class="slide">belongs_to</dt>
         <dd class="slide"><strong>the only real thing modeled in DDL</strong></dd>
         <dd class="slide">"Album"."artist_id" â†’ "Artist"."id"
            <p class="slide">album <strong>belongs to</strong> artist</p>
            <p class="slide">non-undef accessor*</p>
            <p class="slide">*caveat because users are liars and databases are
            theives</p>
         </dd>

         <dt class="slide">has_many</dt>
         <dd class="slide">other side of belongs to</dd>
         <dd class="slide">"Artist"."id" â†’ "Album"."artist_id"
            <p class="slide">artist <strong>has many</strong> albums</p>
            <p class="slide">RS accessor</p>
         </dd>
      </dl>
      <p class="slide">Questions?</p>
   </div>

   <div class="slide">
      <h2>Deobfuscating Relationships ðŸ’¡</h2>

      <dl>
         <dt class="slide">might_have</dt>
         <dd class="slide">same as has_many but zero or one (rare)</dd>
         <dd class="slide">"Artist"."id" â†’ "PreviousName"."artist_id"
            <p class="slide">artist <strong>might have</strong> a previous name</p>
            <p class="slide">Natalie Portman's Shaved Head â†’ Brite Futures</p>
            <p class="slide">undefable accessor</p>
         </dd>

         <dt class="slide">has_one</dt>
         <dd class="slide">same as has_many but exactly one (more rare)</dd>
         <dd class="slide">(first_album) "Artist"."id" â†’ "Album"."artist_id"
            <p class="slide">artist <strong>has one</strong> first album</p>
            <p class="slide">non-undef accessor*</p>
            <p class="slide">*caveat because ...</p>
         </dd>
      </dl>
   </div>

   <div class="slide">
      <h2>Definition via Perl - Result Class</h2>

      <div class="slide">
         <pre>
package My::Schema::Result::Device;

use My::Schema::Candy;

primary_column id => {
   data_type => 'int',
   is_auto_increment => 1,
};

column type_id => { data_type => 'int' };

column name => {
   data_type => 'varchar',
   size      => 128,
};

column last_checkin => {
   data_type   => 'datetime',
   is_nullable => 1,
};

column is_enabled => { data_type => 'bit' };

has_many computer_device_links => '::Computer_Device', 'device_id';
belongs_to type => '::DeviceType', 'type_id';

unique_constraint name_and_type => [qw(name type_id)];

1;
         </pre>
      </div>
   </div>

   <!-- TODO: m2m? -->

   <div class="slide">
      <h2>Definition via Perl - ResultSource</h2>

      <ol>
         <li class=slide>Represents table or view</li>
         <li class=slide>Defined entirely as a side effect of the Result Class
         definition above</li>
         <li class=slide>(Or the other way around)</li>
      </ol>
   </div>

   <div class="slide">
      <h2>Definition via Perl - ResultSet</h2>

      <ol>
         <li class="slide">Represents query</li>
      </ol>
   </div>

   <div class="slide">
      <h2>DBIC at "Run" Time</h2>
      <ol>
         <li class="slide">ResultSet</li>
         <li class="slide">Schema</li>
         <li class="slide">Result</li>
         <li class="slide">ResultSet</li>
      </ol>
   </div>

   <div class="slide">
      <h2>Misc. Debris</h2>
      <ol>
         <li class="slide">Storage</li>
      </ol>
   </div>

   <div class="slide">
      <h2>Extensions You'll Need</h2>
      <ol>
         <li class="slide">Deployment</li>
         <li class="slide">Result</li>
         <li class="slide">ResultSet</li>
      </ol>
   </div>

   <div class="slide">
      <h2>DBIC at "Compile" Time - Redux</h2>

      <ol>
         <li class="slide">Custom Inflation</li>
         <li class="slide">Augmented Inflation</li>
      </ol>
   </div>

   <div class="slide">
      <h2>DBIC at "Run" Time - Redux</h2>

      <ol>
         <li class="slide">Fast-In: population</li>
         <li class="slide">Fast-Out: Subqueries</li>
         <li class="slide">Fast-Out: Correlated Subqueries</li>
      </ol>
   </div>

<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<p class="deck-status">
   <span class="deck-status-current"></span>
   /
   <span class="deck-status-total"></span>
</p>

<form action="." method="get" class="goto-form">
   <label for="goto-slide">Go to slide:</label>
   <input type="number" name="slidenum" id="goto-slide">
   <input type="submit" value="Go">
</form>

<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<script src="deck.js/jquery.min.js"></script>

<!-- Deck Core and extensions -->
<script src="/deck.js/core/deck.core.js"></script>
<script src="/deck.js/extensions/menu/deck.menu.js"></script>
<script src="/deck.js/extensions/goto/deck.goto.js"></script>
<script src="/deck.js/extensions/status/deck.status.js"></script>
<script src="/deck.js/extensions/navigation/deck.navigation.js"></script>

<!-- <script type="text/javascript" src="SyntaxHighlighter/scripts/XRegExp.js"></script> -->
<!-- <script type="text/javascript" src="SyntaxHighlighter/scripts/shCore.js"></script> -->
<!-- <script type="text/javascript" src="SyntaxHighlighter/scripts/shBrushPerl.js"></script> -->

<!-- Specific to this page -->
<script src="/index.js"></script>

</body>
</html>

